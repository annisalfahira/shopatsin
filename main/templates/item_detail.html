{% extends 'base.html' %}
{% load humanize %}
{% block title %}Product #{{ item.pk }} — ShopAtSin{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-warm-grey rounded-xl shadow overflow-hidden">
      {% if item.thumbnail %}
        <img src="{{ item.thumbnail }}" alt="{{ item.name }}" class="w-full">
      {% else %}
        <div class="aspect-video bg-warm-grey/70 flex items-center justify-center text-maroon-dark">No Image</div>
      {% endif %}
    </div>

    <div class="bg-warm-grey rounded-xl shadow p-5">
      <h1 class="text-2xl font-semibold mb-2">{{ item.name }}</h1>
      <p class="text-sm text-maroon-dark/70 mb-1">#{{ item.pk }} • {{ item.category }}</p>
      {% if item.price %}
        <p class="text-xl font-semibold mb-3">Rp {{ item.price|intcomma }}</p>
      {% endif %}
      {% if item.description %}
        <p class="text-maroon-dark/90 mb-4">{{ item.description }}</p>
      {% endif %}

      <div class="flex flex-wrap items-center gap-2">
        <a href="{% url 'main:show_main' %}"
           class="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium border-2 border-warm-grey text-maroon-dark hover:bg-warm-grey">
          Back
        </a>

        {% if user.is_authenticated and item.user == user %}
          <input type="hidden" id="csrf-token" value="{{ csrf_token }}">
          <a href="{% url 'main:edit_item' item.pk %}"
             class="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium border-2 border-maroon text-maroon hover:bg-maroon hover:text-beige">
            Edit
          </a>

          <button type="button" id="detail-delete-btn"
             class="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium border-2 border-[#b02a37] text-[#b02a37] hover:bg-[#b02a37] hover:text-white">
            Delete
          </button>
        {% endif %}
      </div>

      {% if item.created_at or item.updated_at %}
        <div class="mt-4 text-xs text-maroon-dark/70">
          {% if item.created_at %}Created: {{ item.created_at|date:"d M Y H:i" }}{% endif %}
          {% if item.updated_at %} • Updated: {{ item.updated_at|date:"d M Y H:i" }}{% endif %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
<script>
  (function() {
    const deleteBtn = document.getElementById("detail-delete-btn");
    if (!deleteBtn) return;
    const csrfInput = document.getElementById("csrf-token");
    const csrfToken = csrfInput ? csrfInput.value : "";
    deleteBtn.addEventListener("click", async () => {
      if (!confirm("Hapus produk ini?")) return;
      try {
        const response = await fetch("{% url 'main:delete_item_ajax' item.pk %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": csrfToken,
            "X-Requested-With": "XMLHttpRequest",
          },
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.message || "Failed to delete product.");
        window.showToast?.(data.message || "Product deleted successfully.", "success");
        window.location.href = "{% url 'main:show_main' %}";
      } catch (err) {
        const message = err.message || "Failed to delete product.";
        window.showToast?.(message, "error");
        console.error(err);
      }
    });
  })();
</script>
{% endblock %}
